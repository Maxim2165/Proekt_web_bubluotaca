{% extends "base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'users/css/profile_new.css' %}">
{% endblock %}

{% block title %}Профиль{% endblock %}

{% block content %}

<div class="profile-page">

  <!-- Заголовок страницы -->
  <div class="profile-title">
    Ваши данные
  </div>

  <!-- Первый ряд -->
  <div class="profile-section profile-section-top">

    <!-- ЧИТАТЕЛЬСКАЯ КАРТОЧКА -->
    <div class="profile-card">
      <div class="profile-card-title">
        Читательская карточка
      </div>

      <div class="profile-row">
        <div class="profile-label">Имя читателя:</div>
        <div class="profile-value">{{ user.first_name|default:user.username }}</div>
      </div>

      <div class="profile-row">
        <div class="profile-label">Персональный аутентификатор:</div>
        <div class="profile-value">{{ user.username }}</div>
      </div>

      <div class="profile-row">
        <div class="profile-label">Электронная почта:</div>
        <div class="profile-value">{{ user.email }}</div>
      </div>

      <div class="profile-row">
        <div class="profile-label">Дата выдачи читательской карточки:</div>
        <div class="profile-value">{{ user.date_joined|date:"d E Y" }}</div>
      </div>
    </div>

    <!-- ИЗБРАННОЕ -->
    <div class="profile-card">
      <div class="profile-card-title">
        Избранное
      </div>

      {% if favorite_books %}
  {% for book in favorite_books %}
    <div class="profile-row profile-row-between">
      <a href="{% url 'books:detail' book.pk %}" class="profile-label">
        {{ book.title }}
      </a>
      <div class="profile-muted">
        Скачано: {{ book.downloads_count }}
      </div>
    </div>
  {% endfor %}
{% else %}
  <div class="profile-muted">Список избранного пуст.</div>
{% endif %}
    </div>

  </div>

  <!-- Второй ряд -->
  <div class="profile-section profile-section-bottom">

    <!-- ПОСЛЕДНИЕ СКАЧИВАНИЯ -->
    <div class="profile-card">
      <div class="profile-card-title">
        Последние скачивания
      </div>

      {% if downloads %}
        {% for dl in downloads %}
          <div class="profile-row">
            <div class="profile-label">{{ dl.book.title }}</div>
            <div class="profile-muted">
              {{ dl.file_format|upper }} — {{ dl.created_at|date:"d.m.Y" }}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="profile-muted">История скачиваний пуста.</div>
      {% endif %}
    </div>

    <!-- КНОПКИ -->
    <div class="profile-actions">

      <a href="{% url 'users:profile_analytics' %}" class="btn-new btn-new-dark">
        Мой обзор
      </a>

      <a href="{% url 'users:profile_edit' %}" class="btn-new btn-new-outline">
        Редактировать профиль
      </a>

      <!-- Форма выхода -->
  <form method="post" action="{% url 'users:logout' %}">
    {% csrf_token %}
    <button type="submit" class="btn-new btn-new-dark">
      Выйти
    </button>
  </form>
    </div>

  </div>

</div>

{% endblock %}
